---
title: "Prepare Cyclistic Dataset"
output: github_document
---

## Executive Summary

- Do we have the appropriate rights to use this data?
  - ![checkmark](img/checkmark.png) Yes, see "Data Rights", below.
- Does the data seem complete?
  - **? Problematic.** 10% of the station names are missing. It might be possible to
    fill this in using the geographical coordinates which are almost
    entirely complete.
- Has it been anonymized?
  - ![checkmark](img/checkmark.png) Yes. Only an anonymous `ride_id` identifies
    the ride.
- Does it appear we can perform the business task with this dataset?
  - **? Problematic.** It might be difficult to infer *how* or *why* the bikes are being used
  - We will want to obtain map data for Chicago so we can sensibly interpret
    the location information.
    - Tableau can help with this visualization
      - has map data built-in
    - Maps that show districting information (commercial, industrial, 
    residential, etc) might be useful in teasing out usage patterns
    by user type.
- **Data has been limited to sources as new or newer than April 2020** to
  find only current trends.

## Data Rights
The data being used is available under 
[this licence.](https://www.divvybikes.com/data-license-agreement)
The agreement allows us the right to independently analyze this dataset. 

## Detailed examination

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
```

```{r load data, include=FALSE}
df <- read_csv("data/202105-divvy-tripdata.csv",
               col_types = cols(member_casual = 'f',
                                rideable_type = 'f'))
```
Let's examine our raw dataset.  The output is long, but it gives us a high-level
view of all the data available to us.
```{r summarize}
names(df)  # What variables are in the dataset?
skimr::skim(df)
```
### Observations & Sanity Checks

- About 10% of the observations are missing the station name and/or ID.  However,
almost all rides have the latitude/longitude information and we might be able
to use this to fill in the missing stations.  We'll investigate this in a 
later step.
- The May dataset includes some rides from June.
- It's worth noting that the times are recorded down to the second.
- Cyclistic claims over 600 stations in the network. Dataset reports about 680.
seems fine.

## Can we infer the station names based on coordinates? 

**Summary: Yes, looks like it.**
Let's see what the mean latitude & longitude is for each station name. Below,
it appears at first glance the stations can be clearly identified by their map
coordinates. Later, we will train a model to predict the station name based
on the coordinates, and then fill in the matching `station_id`. In the context
of finding differences between user types, prediction errors like placing a
trip start at a station a few blocks away should not bias the analysis, and
would also give us an extra 10% of data to work with.
```{r infer station name?, echo=FALSE }
# Show more digits: the pillar package controls how tibbles display sigfigs
options(pillar.sigfig = 6)  
df %>% group_by(start_station_name) %>% 
  summarise(xbar = mean(start_lng), 
            ybar = mean(start_lat), 
            sd_x = sd(start_lng), 
            sd_y = sd(start_lat)) %>% 
  head(10)
```

```{r show Aberdeen stations, echo = FALSE}
df %>% 
  filter(start_station_name == 'Aberdeen St & Jackson Blvd' | 
           start_station_name == 'Aberdeen St & Monroe St') %>% 
  distinct(across(c(start_station_name, start_lat))) %>% 
  head(10)
```








